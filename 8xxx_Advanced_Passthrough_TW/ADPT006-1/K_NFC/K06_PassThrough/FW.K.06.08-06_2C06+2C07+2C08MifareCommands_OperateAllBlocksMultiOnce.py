#ID:Mifare-ReadWriteMulitiBlock

# Head #########################################
#LABLE:
#POURPOSE: Write Mifare classic muliti blocks once (skip key blocks) + Read Muliti Mifare classic blokcs once
#INPUT:
#OUTPUT: 
#################################################

#!/usr/bin/env python

# Import #######################################
import Utility_Lib.Pro_PreFile

from  Utility_Lib.Pro_PreFile import *
#################################################

# Variable #####################################
Robot = DL.isRobot
# true - robot, false - manual
InitPKI = True
# true - MasterReset + Activate + Key Injection, false skip
DeviceType = -1
# 0 - Vivo K3,K4, > 0 - Neoii
DL.warnings = 0 
# Ready for DVT Warning Count
DL.fails = 0
 # Test Part Issue Count
Index = 0
# Child Cases Index

C2C01 = []
C2C01.append(["PT Stop","2C 01 00","5669564F7465636832002C"])
C2C01.append(["PT Start","2C 01 01","5669564F7465636832002C0000001C9B"])

C2C02 = []
C2C02.append([" Poll for Token (OK)","2C 02 1F 00","5669564F7465636832002C00000503"])

C2C06 = []
C2C06.append(["Mifare auth - Sector 1","2C 06 01 01 FF FF FF FF FF FF","5669564F7465636832002C0000001C9B"])

C2C08 = []
C2C08.append(["-- Write Blocks #1,2 -----","2C 08 32 01 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 11 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22","5669564F7465636832002C0000001C9B"])
C2C08.append(["-- Write  Blocks #4,5,6 -----","2C 08 33 04 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 55 55 55 55 55 55 55 55 55 55 55 55 55 55 55 55 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66 66","5669564F7465636832002C0000001C9B"])
C2C08.append(["-- Write Block #8,9,10,12 -----","2C 08 34 08 88 88 88 88 88 88 88 88 88 88 88 88 88 88 88 88 99 99 99 99 99 99 99 99 99 99 99 99 99 99 99 99 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12 12","5669564F7465636832002C0000001C9B"])
C2C08.append(["-- Write Block #13,14,16,17,18 -----","2C 08 35 0D 13 13 13 13 13 13 13 13 13 13 13 13 13 13 13 13 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 14 16 16 16 16 16 16 16 16 16 16 16 16 16 16 16 16 17 17 17 17 17 17 17 17 17 17 17 17 17 17 17 17 18 18 18 18 18 18 18 18 18 18 18 18 18 18 18 18","5669564F7465636832002C0000001C9B"])
C2C08.append(["-- Write Block #20,21,22,24,25,26 -----","2C 08 36 14 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 21 21 21 21 21 21 21 21 21 21 21 21 21 21 21 21 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 24 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 26 26 26 26 26 26 26 26 26 26 26 26 26 26 26 26","5669564F7465636832002C0000001C9B"])
C2C08.append(["-- Write 12 Blocks from #28 -----","2C 08 3C 1C 28 28 28 28 28 28 28 28 28 28 28 28 28 28 28 28 29 29 29 29 29 29 29 29 29 29 29 29 29 29 29 29 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 32 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 33 34 34 34 34 34 34 34 34 34 34 34 34 34 34 34 34 36 36 36 36 36 36 36 36 36 36 36 36 36 36 36 36 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 38 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42","5669564F7465636832002C0000001C9B"])
C2C08.append(["-- Write 15 Blocks from #44 -----","2C 08 3F 2C 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 44 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 45 46 46 46 46 46 46 46 46 46 46 46 46 46 46 46 46 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 48 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 49 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 50 52 52 52 52 52 52 52 52 52 52 52 52 52 52 52 52 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 53 54 54 54 54 54 54 54 54 54 54 54 54 54 54 54 54 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 56 57 57 57 57 57 57 57 57 57 57 57 57 57 57 57 57 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 58 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 60 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 62 62 62 62 62 62 62 62 62 62 62 62 62 62 62 62","5669564F7465636832002C0000001C9B"])


C2C07 = []
C2C07.append(["-- Read 5 Block and start at Block 0 (Blocks 0,1,2,4 and 5 are read --- Trailer Block 3 is skipped). -----","2C 07 35 00","5669564F7465636832002C000050????????????????????????????????11111111111111111111111111111111222222222222222222222222222222224444444444444444444444444444444455555555555555555555555555555555????"])
C2C07.append(["Read 15 Block and start at Block 0 (Blocks 0 to 18 are read --- Trailer Blocks 3, 7, 11, and 15 are skipped)","2C 07 3F 00","5669564F7465636832002C0000F0????????????????????????????????1111111111111111111111111111111122222222222222222222222222222222444444444444444444444444444444445555555555555555555555555555555566666666666666666666666666666666888888888888888888888888888888889999999999999999999999999999999910101010101010101010101010101010121212121212121212121212121212121313131313131313131313131313131314141414141414141414141414141414161616161616161616161616161616161717171717171717171717171717171718181818181818181818181818181818????"])
C2C07.append(["Read 3Blocks, starting Block #16","2C 07 33 10","5669564F7465636832002C000030161616161616161616161616161616161717171717171717171717171717171718181818181818181818181818181818"])
C2C07.append(["Read 15 Block and start at Block 19 (Blocks 19 to 38 are read --- Trailer Blocks 19, 23, 27, 31, 35 are skipped)","2C 07 3F 13","5669564F7465636832002C0000F0202020202020202020202020202020202121212121212121212121212121212122222222222222222222222222222222242424242424242424242424242424242525252525252525252525252525252526262626262626262626262626262626282828282828282828282828282828282929292929292929292929292929292930303030303030303030303030303030323232323232323232323232323232323333333333333333333333333333333334343434343434343434343434343434363636363636363636363636363636363737373737373737373737373737373738383838383838383838383838383838ACD1"])
C2C07.append(["Read 6 Blocks, starting Block #32","2C 07 36 20","5669564F7465636832002C000060323232323232323232323232323232323333333333333333333333333333333334343434343434343434343434343434363636363636363636363636363636363737373737373737373737373737373738383838383838383838383838383838"])
C2C07.append(["Read 15 Block and start at Block 39 (Blocks 39 to 58 are read --- Trailer Blocks 39, 43, 47, 51, 55 are skipped)","2C 07 3F 27","5669564F7465636832002C0000F040404040404040404040404040404040414141414141414141414141414141414242424242424242424242424242424244444444444444444444444444444444454545454545454545454545454545454646464646464646464646464646464648484848484848484848484848484848494949494949494949494949494949495050505050505050505050505050505052525252525252525252525252525252535353535353535353535353535353535454545454545454545454545454545456565656565656565656565656565656575757575757575757575757575757575858585858585858585858585858585868AD"])
C2C07.append(["Read 12Blocks, starting Block #48","2C 07 3C 30","5669564F7465636832002C0000C0484848484848484848484848484848484949494949494949494949494949494950505050505050505050505050505050525252525252525252525252525252525353535353535353535353535353535354545454545454545454545454545454565656565656565656565656565656565757575757575757575757575757575758585858585858585858585858585858606060606060606060606060606060606161616161616161616161616161616162626262626262626262626262626262223A"])



C0930 = [["Get device memory","09 30"]]

##################################################



# Ready for DVT ##################################
DeviceType = Pro_GetDevice().Run(DL)
if(-1==DeviceType):
	DL.warnings = 1
	DL.setText("RED","Please define device type in Pro_GetDevice")
if(0<DeviceType and 10>=DeviceType):DL.setText("BLACK", "<Kiosk>")
if(10<DeviceType):DL.setText("BLACK", "<NEOII>")
##################################################



##################################################

# Test Part ######################################

if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(C2C01[0][0],C2C01[0][1],50000,False,DL),C2C01[0][2],DL)): DL.warnings = DL.warnings +1
if(10<DeviceType):
	strMemory = Pro_SendCmd().Run(C0930[0][0],C0930[0][1],5000,False,DL)
	strMemory = strMemory.replace(" ","")
	strMemory = strMemory[0:len(strMemory)-12]

if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(C2C01[1][0],C2C01[1][1],50000,False,DL),C2C01[1][2],DL)): DL.warnings = DL.warnings +1

if (Robot == True):	DL.Robot_SwipeorTapCard(4)
else: DL.ShowMessageBox("Note!", "Tap Mafire S50, not move until the end", 0)
if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(C2C02[0][0],C2C02[0][1],50000,False,DL),C2C02[0][2],DL)): DL.warnings = DL.warnings +1

if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(C2C06[0][0],C2C06[0][1],50000,False,DL),C2C06[0][2],DL)): DL.fails = DL.fails +1
for Case in C2C08:
	if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(Case[0],Case[1],50000,False,DL),Case[2],DL)): DL.fails = DL.fails +1
for Case in C2C07:
	if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(Case[0],Case[1],50000,False,DL),Case[2],DL)): DL.fails = DL.fails +1
    
if(Robot == True):  DL.Robot_RemoveCard()
else: DL.ShowMessageBox("Note!", "Remove card", 0)
if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(C2C01[0][0],C2C01[0][1],50000,False,DL),C2C01[0][2],DL)): DL.fails = DL.fails +1

#Check device memory not change after script
if(10<DeviceType):
    if(False ==  Pro_SendCmd().RunCK(Pro_SendCmd().Run(C0930[0][0],C0930[0][1],5000,False,DL),strMemory,DL)): 
        DL.fails = DL.fails +1
        DL.setText("RED","Device memory changed after script")

##################################################


# Result Count ####################################
# Warning Count & Fail Count
if(0 < (DL.fails + DL.warnings)):
	DL.setText("RED", "[Test Result] - Fail\r\n Warning:" +str(DL.warnings)+"\r\n Fail:" + str(DL.fails))
else:
	DL.setText("GREEN", "[Test Result] - PASS\r\n Warning:0\r\n Fail:0" )

##################################################

#! Script END